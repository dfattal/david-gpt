{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Persona Contract Schema",
  "description": "Schema for persona contracts - the definitive specification for document processing",
  "type": "object",
  "required": ["schema_version", "persona_name", "provenance", "global", "metadata", "kg", "doc_types"],
  "properties": {
    "schema_version": {
      "type": "integer",
      "minimum": 1
    },
    "persona_name": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_-]*$"
    },
    "provenance": {
      "type": "object",
      "required": ["generated_by", "generated_at", "inputs_hash"],
      "properties": {
        "generated_by": {
          "enum": ["deterministic", "gemini-cli", "hybrid"]
        },
        "model": {
          "type": "string"
        },
        "generated_at": {
          "type": "string",
          "format": "date-time"
        },
        "inputs_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        }
      }
    },
    "global": {
      "type": "object",
      "required": ["abstract_max_words", "metadata_chunk_max_chars", "content_chunk_min_chars", "content_chunk_max_chars"],
      "properties": {
        "abstract_max_words": {
          "type": "integer",
          "minimum": 50,
          "maximum": 500
        },
        "metadata_chunk_max_chars": {
          "type": "integer",
          "minimum": 500,
          "maximum": 2000
        },
        "content_chunk_min_chars": {
          "type": "integer",
          "minimum": 200,
          "maximum": 1000
        },
        "content_chunk_max_chars": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 5000
        },
        "chunk_overlap_percentage": {
          "type": "integer",
          "minimum": 5,
          "maximum": 30,
          "default": 15
        },
        "require_document_url_if_available": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["identifiers", "dates", "actor_roles"],
      "properties": {
        "identifiers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "dates": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "actor_roles": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        }
      }
    },
    "kg": {
      "type": "object",
      "required": ["entity_kinds", "edge_types"],
      "properties": {
        "entity_kinds": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "edge_types": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/edgeType"
          },
          "minItems": 1
        }
      }
    },
    "doc_types": {
      "type": "object",
      "patternProperties": {
        "^[a-z][a-z0-9_-]*$": {
          "$ref": "#/definitions/docType"
        }
      },
      "minProperties": 1
    },
    "vocab_hints": {
      "type": "object",
      "properties": {
        "technologies": {
          "type": "array",
          "items": {"type": "string"}
        },
        "oems": {
          "type": "array",
          "items": {"type": "string"}
        },
        "products": {
          "type": "array",
          "items": {"type": "string"}
        },
        "concepts": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "proposals": {
      "type": "object",
      "description": "Proposed new enum values that need approval",
      "properties": {
        "new_doc_types": {
          "type": "array",
          "items": {"type": "string"}
        },
        "new_entity_kinds": {
          "type": "array",
          "items": {"type": "string"}
        },
        "new_edge_types": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    }
  },
  "definitions": {
    "edgeType": {
      "type": "object",
      "required": ["type", "src_kinds", "dst_kinds", "evidence_required"],
      "properties": {
        "type": {
          "type": "string"
        },
        "src_kinds": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1
        },
        "dst_kinds": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1
        },
        "evidence_required": {
          "type": "boolean"
        },
        "description": {
          "type": "string"
        }
      }
    },
    "docType": {
      "type": "object",
      "required": ["required_frontmatter", "sections_order"],
      "properties": {
        "required_frontmatter": {
          "type": "object",
          "properties": {
            "identifiers": {
              "type": "array",
              "items": {"type": "string"}
            },
            "identifiers_any_of": {
              "type": "array",
              "items": {"type": "string"}
            },
            "dates": {
              "type": "array",
              "items": {"type": "string"}
            },
            "dates_any_of": {
              "type": "array",
              "items": {"type": "string"}
            },
            "actors": {
              "type": "array",
              "items": {"type": "string"}
            },
            "actors_any_of": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        },
        "sections_order": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1
        },
        "metadata_section": {
          "type": "string"
        },
        "must_include": {
          "type": "array",
          "items": {"type": "string"}
        },
        "notes": {
          "type": "string"
        }
      }
    }
  }
}